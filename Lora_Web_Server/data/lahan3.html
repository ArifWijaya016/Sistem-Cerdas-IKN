<!DOCTYPE html>
<html>

<head>
  <title>SMART FARM DASHBOARD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">

  <link rel="stylesheet" href="bootstrap.min.css">
  <script src="gauge.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-lg ">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03"
        aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand " href="#">
        <p class="judul-brand">Smart System</p>
      </a>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 judul">
          <li class="nav-item ">
            <a class="nav-link" aria-current="page" href="index.html">
              <p class="lahan"> Lahan 1</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lahan2.html">
              <p class="lahan"> Lahan 2</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="lahan3.html">
              <p class="lahan"> Lahan 3</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lahan4.html">
              <p class="lahan"> Lahan 4</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- end -->
  <nav class="navbar nav-top bg-light">
    <div class="container">
      <div class="navbar-brand">
        <img src="ug.png" width="100" height="100" alt="" class="">
        <img src="kampusmerdeka.png" width="100" height="100" alt="" class="space">
        <img src="kampusmerdekaa.png" width="100" height="100" alt="" class=" space">
        <img src="ppunew.png" width="100" height="100" alt="" class="space">
        <img src="diktii.png" width="100" height="100" alt="" class="space trans">
      </div>
    </div>
  </nav>

  <!-- nav 2 -->

  <!-- end -->

  <div class="container-fluid">
    <br>
    <p class="judul-proyek text-center">Sistem Cerdas Irigasi</p>
    <div class="row">
      <div class="col">
        <div class="card">
          <p class="card-title">Natrium</p>
          <canvas id="natriumLahan3"></canvas>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <p class="card-title">Posfor</p>
          <canvas id="potasiumLahan3"></canvas>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <p class="card-title">Kalium</p>
          <canvas id="kaliumLahan3"></canvas>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <p class="card-title">Kelembaban</p>
          <canvas id="KelembabanLahan3"></canvas>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <p class="card-title">pH</p>
          <canvas id="phLahan3"></canvas>
        </div>
      </div>

    </div>

    <!-- <div class="content">
    <div class="card-grid-1">
      <div class="card">
        <p class="card-title">Kelembapan Tanah Area A</p>
        <canvas id="gauge-moisture-A"></canvas>
      </div>
    </div>
    <div class="card-grid-2">
      <div class="card">
        <p class="card-title">Kelembapan Tanah Area A</p>
        <canvas id="gauge-moisture-B"></canvas>
      </div>
    </div>
  </div> -->
    <br>
    <footer>
      <div class="foot">
        <h6 class="foot-text">Develop By &copy; Riset Gundar</h6>
      </div>
    </footer>
    <!-- <script src="script.js"></script> -->
    <!-- <script src="./framework/js/bootstrap.bundle.js"></script> -->
    <script src="bootstrap.bundle.js"></script>
</body>
<script>
  window.addEventListener('load', getReadings);
  let widthGauge = 170;
  let heightGauge = 170;
  let majorTickVarNatrium = ["0",
    "10",
    "20",
    "30",
    "40",
    "50",
    "60",
    "70",
    "80",
    "90",
    "100"
  ]
  let majorTickPotasium = [
    "0",
    "10",
    "20",
    "30",
    "40",
    "50",
    "60",
    "70",
    "80",
    "90",
    "100"
  ]
  let majorTickKalium = ["0",
    "10",
    "20",
    "30",
    "40",
    "50",
    "60",
    "70",
    "80",
    "90",
    "100"
  ]
  let majorTickpH = ["0",
    "1",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7",
    "8",
    "9",
    "10",
    "11",
    "12",
    "13",
    "14"
  ]
  let majorTickSoil = ["0",
    "10",
    "20",
    "30",
    "40",
    "50",
    "60",
    "70",
    "80",
    "90",
    "100"
  ]
  let heightNatrium = [{
      "from": 80,
      "to": 100,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 20,
      "color": "#dbd7cc"
    }, {
      "from": 60,
      "to": 80,
      "color": "#f2ee02"
    }, {
      "from": 20,
      "to": 60,
      "color": "#02f262"
    }
  ]
  let heightPotasium = [{
      "from": 80,
      "to": 100,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 20,
      "color": "#dbd7cc"
    }, {
      "from": 60,
      "to": 80,
      "color": "#f2ee02"
    }, {
      "from": 20,
      "to": 60,
      "color": "#02f262"
    }
  ]
  let heightKalium = [{
      "from": 80,
      "to": 100,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 20,
      "color": "#dbd7cc"
    }, {
      "from": 60,
      "to": 80,
      "color": "#f2ee02"
    }, {
      "from": 20,
      "to": 60,
      "color": "#02f262"
    }
  ]
  let heightpH = [{
      "from": 0,
      "to": 2,
      "color": "#f20202"
    },
    {
      "from": 2,
      "to": 4,
      "color": "#e54242"
    }, {
      "from": 7,
      "to": 14,
      "color": "#f2ee02"
    }
  ]
  let heightSoil = [{
      "from": 80,
      "to": 100,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 20,
      "color": "#dbd7cc"
    }, {
      "from": 60,
      "to": 80,
      "color": "#f2ee02"
    }, {
      "from": 20,
      "to": 60,
      "color": "#02f262"
    }
  ]
  let colorPlatevar = "#fff";
  let needleTypeVar = 'arrow';
  let minorTicksVar = 10;

  var natriumLahan3Gauge = new RadialGauge({
    renderTo: 'natriumLahan3',
    width: widthGauge,
    height: heightGauge,
    units: "ppm",
    minValue: 0,
    maxValue: 100,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 0,
    majorTicks: majorTickVarNatrium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightNatrium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var potasiumLahan3Gauge = new RadialGauge({
    renderTo: 'potasiumLahan3',
    width: widthGauge,
    height: heightGauge,
    units: "ppm",
    minValue: 0,
    maxValue: 100,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickPotasium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightPotasium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var kaliumLahan3Gauge = new RadialGauge({
    renderTo: 'kaliumLahan3',
    width: widthGauge,
    height: heightGauge,
    units: "ppm ",
    minValue: 0,
    maxValue: 100,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickKalium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightKalium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var KelembabanLahan3Gauge = new RadialGauge({
    renderTo: 'KelembabanLahan3',
    width: widthGauge,
    height: heightGauge,
    units: "Humidity (%)",
    minValue: 0,
    maxValue: 100,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickSoil,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightSoil,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var phLahan3Gauge = new RadialGauge({
    renderTo: 'phLahan3',
    width: widthGauge,
    height: heightGauge,
    units: "",
    minValue: 0,
    maxValue: 14,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickpH,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightpH,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  function getReadings() {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);
        console.log(myObj);

        let natriumLahan3Var = myObj.natriumLahan3FromArduino;
        let kelembabanLahan3Var = myObj.kelembabanLahan3FromArduino;
        let potasiumLahan3Var = myObj.potasiumLahan3FromArduino;
        let kaliumLahan3Var = myObj.kaliumLahan3FromArduino;
        let phLahan3Var = myObj.phLahan3FromArduino;

        KelembabanLahan3Gauge.value = kelembabanLahan3Var;
        natriumLahan3Gauge.value = natriumLahan3Var;
        potasiumLahan3Gauge.value = potasiumLahan3Var;
        kaliumLahan3Gauge.value = kaliumLahan3Var;
        phLahan3Gauge.value = phLahan3Var;

        console.log(kelembabanLahan3Var);
        console.log(natriumLahan3Var);
        console.log(potasiumLahan3Var);
        console.log(kaliumLahan3Var);
        console.log(phLahan3Var);

      }
    };
    xhr.open("GET", "/readings", true);
    xhr.send();
  }

  if (!!window.EventSource) {
    var source = new EventSource('/events');

    source.addEventListener('open', function (e) {
      console.log("Events Connected");
    }, false);

    source.addEventListener('error', function (e) {
      if (e.target.readyState != EventSource.OPEN) {
        console.log("Events Disconnected");

      }
    }, false);

    source.addEventListener('message', function (e) {
      console.log("message", e.data);
    }, false);

    source.addEventListener('new_readings', function (e) {
      console.log("new_readings", e.data);
      var myObj = JSON.parse(e.data);
      console.log(myObj);


      // section 2
      KelembabanLahan3Gauge.value = myObj.kelembabanLahan3FromArduino;
      kaliumLahan3Gauge.value = myObj.kaliumLahan3FromArduino;
      potasiumLahan3Gauge.value = myObj.potasiumLahan3FromArduino;
      natriumLahan3Gauge.value = myObj.natriumLahan3FromArduino;
      phLahan3Gauge.value = myObj.phLahan3FromArduino

      // gaugeSoil_D.value = myObj.moisture;
    }, false);
  }
</script>

</html>